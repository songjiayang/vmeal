/*******************************************************************************
* KindEditor - WYSIWYG HTML Editor for Internet
* Copyright (C) 2006-2011 kindsoft.net
*
* @author Roddy <luolonghao@gmail.com>
* @site http://www.kindsoft.net/
* @licence http://www.kindsoft.net/license.php
*******************************************************************************/
// Baidu Maps: http://dev.baidu.com/wiki/map/index.php?title=%E9%A6%96%E9%A1%B5
KindEditor.plugin("baidumap",function(e){var t=this,n="baidumap",r=t.lang(n+"."),i=e.undef(t.mapWidth,558),s=e.undef(t.mapHeight,360);t.clickToolbar(n,function(){function v(){h=d[0].contentWindow,p=e.iframeDoc(d)}var o=['<div style="padding:10px 20px;">','<div class="ke-header">','<div class="ke-left">',r.address+' <input id="kindeditor_plugin_map_address" name="address" class="ke-input-text" value="" style="width:200px;" /> ','<span class="ke-button-common ke-button-outer">','<input type="button" name="searchBtn" class="ke-button-common ke-button" value="'+r.search+'" />',"</span>","</div>",'<div class="ke-right">','<input type="checkbox" id="keInsertDynamicMap" name="insertDynamicMap" value="1" /> <label for="keInsertDynamicMap">'+r.insertDynamicMap+"</label>","</div>",'<div class="ke-clearfix"></div>',"</div>",'<div class="ke-map" style="width:'+i+"px;height:"+s+'px;"></div>',"</div>"].join(""),u=t.createDialog({name:n,width:i+42,title:t.lang(n),body:o,yesBtn:{name:t.lang("yes"),click:function(e){var n=h.map,r=n.getCenter(),o=r.lng+","+r.lat,u=n.getZoom(),a=[c[0].checked?t.pluginsPath+"baidumap/index.html":"http://api.map.baidu.com/staticimage","?center="+encodeURIComponent(o),"&zoom="+encodeURIComponent(u),"&width="+i,"&height="+s,"&markers="+encodeURIComponent(o),"&markerStyles="+encodeURIComponent("l,A")].join("");c[0].checked?t.insertHtml('<iframe src="'+a+'" frameborder="0" style="width:'+(i+2)+"px;height:"+(s+2)+'px;"></iframe>'):t.exec("insertimage",a),t.hideDialog().focus()}},beforeRemove:function(){l.remove(),p&&p.write(""),d.remove()}}),a=u.div,f=e('[name="address"]',a),l=e('[name="searchBtn"]',a),c=e('[name="insertDynamicMap"]',u.div),h,p,d=e('<iframe class="ke-textarea" frameborder="0" src="'+t.pluginsPath+'baidumap/map.html" style="width:'+i+"px;height:"+s+'px;"></iframe>');d.bind("load",function(){d.unbind("load"),e.IE?v():setTimeout(v,0)}),e(".ke-map",a).replaceWith(d),l.click(function(){h.search(f.val())})})});